define(["scripts/upfront/settings/modules/base-module","scripts/upfront/settings/fields/show-state","scripts/upfront/preset-settings/state-settings"],function(t,e,s){var i=Upfront.Settings.l10n.preset_manager,o=t.extend({className:"preset_specific",initialize:function(t){this.options=t||{},this.listenTo(this.model,"change",this.onPresetUpdate);var o=this,n=!1,r=!1,a=[];a=Upfront.Application.get_current()!==Upfront.Application.MODE.THEME&&this.options.model.get("theme_preset")===!0||"default"===this.options.model.get("id")||!Upfront.Application.user_can("DELETE_PRESET")?Upfront.Application.get_current()===Upfront.Application.MODE.THEME||"default"!==this.options.model.get("id")&&this.options.model.get("theme_preset")!==!0||!Upfront.Application.user_can("MODIFY_PRESET")?[]:[new Upfront.Views.Editor.Field.Button({model:this.model,label:"Reset",className:"delete_preset",compact:!0,on_click:function(){o.resetPreset()}})]:[new Upfront.Views.Editor.Field.Button({model:this.model,label:i.delete_label,className:"delete_preset",compact:!0,on_click:function(){confirm("Are you sure to delete this preset?")&&o.deletePreset()}})],Upfront.Application.user_can("MODIFY_PRESET")&&(_.each(this.options.stateModules,function(t,e){if("Global"===e){var i=new s({model:this.model,modules:t,state:e});a.push(i)}},this),_.each(this.options.stateModules,function(t,s){if("Global"!==s){var i=new e({state:s});a.push(i),this.listenTo(i,"upfront:presets:state_show",this.showState),n||(n=i)}},this),_.each(this.options.stateModules,function(t,e){if("Global"!==e){var i=new s({model:this.model,modules:t,state:e});a.push(i),r?i.$el.hide():r=i}},this),setTimeout(function(){o.$el.find(".state_settings_button").wrapAll('<div class="state_settings_button_wrapper">');var t=o.$el.find(".state_settings_button_wrapper");t.prev().hasClass("delete_preset")&&t.addClass("move-wrapper-top")},50)),n&&n.$el.addClass("active"),r&&r.$el.show(),this.fields=_(a)},onPresetUpdate:function(){return!!Upfront.Application.user_can("MODIFY_PRESET")&&void this.trigger("upfront:presets:update",this.model.toJSON())},deletePreset:function(){return!!Upfront.Application.user_can("DELETE_PRESET")&&void this.trigger("upfront:presets:delete",this.model)},resetPreset:function(){return!!Upfront.Application.user_can("DELETE_PRESET")&&void this.trigger("upfront:presets:reset",this.model)},showState:function(t){this.$el.find(".state_settings_button").removeClass("active"),this.$el.find(".state_settings_button_"+t).addClass("active"),this.$el.find(".state_settings").hide(),this.$el.find(".state_settings_"+t).show(),this.trigger("upfront:presets:state_show",t)}});return o});