!function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define(["scripts/upfront/upfront-views-editor/commands/command","scripts/upfront/upfront-views-editor/content-editor"],function(o,n){return n.SidebarCommand.extend({tagName:"li",className:"command-popup-list",$popup:{},views:{},currentPanel:!1,render:function(){this.$el.addClass("upfront-entity_list upfront-icon upfront-icon-browse"),Upfront.Application.is_single("post")?this.$el.html('<a title="'+e.posts_pages_comments+'">'+e.posts_pages_comments+"</a>"):this.$el.html('<a title="'+e.posts_pages+'">'+e.posts_pages+"</a>")},on_click:function(){var o=this,n=Upfront.Popup.open(function(n,p,s){var a=t(this);a.empty().append('<p class="upfront-popup-placeholder">'+e.popup_preloader+"</p>"),o.$popup={top:p,content:a,bottom:s}}),p=!1,s=Upfront.data.currentPost&&Upfront.data.currentPost.id?Upfront.data.currentPost.id:_upfront_post_data.post_id;p=!!s,s&&Upfront.data.posts&&Upfront.data.posts.length&&(p=!(!Upfront.data.posts[s]||!Upfront.data.posts[s].get)&&!!parseInt(Upfront.data.posts[s].get("comment_count"),10)),o.$popup.top.html('<ul class="upfront-tabs"><li data-type="posts" class="active">'+e.posts+'</li><li data-type="pages">'+e.pages+"</li>"+(p?'<li data-type="comments">'+e.comments+"</li>":"")+"</ul>"+o.$popup.top.html()).find(".upfront-tabs li").on("click",function(){o.dispatch_panel_creation(this)}),o.dispatch_panel_creation(),n.done(function(){Upfront.Events.off("upfront:posts:sort"),Upfront.Events.off("upfront:posts:post:expand"),Upfront.Events.off("upfront:pages:sort"),Upfront.Events.off("upfront:comments:sort")})},dispatch_panel_creation:function(e){var o=this,p=e?t(e):o.$popup.top.find(".upfront-tabs li.active"),s=p.attr("data-type"),a=(s.charAt(0).toUpperCase()+s.slice(1).toLowerCase(),!1),i=(this.post.id,{});if(o.$popup.top.find(".upfront-tabs li").removeClass("active"),p.addClass("active"),this.currentPanel=s,o.views[s]&&"pages"!=s&&"posts"!=s&&("comments"!=s||Upfront.data.currentPost&&Upfront.data.currentPost.id&&o.views[s].view.collection.postId==Upfront.data.currentPost.id))return this.render_panel(o.views[s]);if("posts"==s)a=new Upfront.Collections.PostList([],{postType:"post"}),a.orderby="post_date",i={filterContent:!0,withAuthor:!0,limit:15};else if("pages"==s)a=new Upfront.Collections.PostList([],{postType:"page"}),a.orderby="post_date",i={limit:15};else{var r=Upfront.data.currentPost&&Upfront.data.currentPost.id?Upfront.data.currentPost.id:_upfront_post_data.post_id;a=new Upfront.Collections.CommentList([],{postId:r}),a.orderby="comment_date"}return a.fetch(i).done(function(t){var e,p;switch(s){case"posts":if(e=null,"undefined"!=typeof o.views[s]&&(e=o.views[s].view.collection.pagination.totalElements),p=a.pagination.totalElements,e==p)return o.render_panel(o.views[s]);a.on("reset sort",o.render_panel,o),views={view:new n.Posts({collection:a,$popup:o.$popup}),search:new n.Search({collection:a}),pagination:new n.Pagination({collection:a})},o.views.posts=views;break;case"pages":if(e=null,"undefined"!=typeof o.views[s]&&(e=o.views[s].view.collection.pagination.totalElements),p=a.pagination.totalElements,e==p)return o.render_panel(o.views[s]);a.on("reset sort",o.render_panel,o),views={view:new n.Pages({collection:a,$popup:o.$popup}),search:new n.Search({collection:a}),pagination:new n.Pagination({collection:a})},o.views.pages=views;break;case"comments":a.on("reset sort",o.render_panel,o),views={view:new n.Comments({collection:a,$popup:o.$popup}),search:new n.Search({collection:a}),pagination:new n.Pagination({collection:a})},o.views.comments=views}o.render_panel()}),!1},render_panel:function(){var t=this,e=this.views[this.currentPanel];e.view.render(),t.$popup.content.html(e.view.$el),e.view.setElement(e.view.$el),t.$popup.bottom.empty(),e.pagination&&(e.pagination.render(),t.$popup.bottom.html(e.pagination.$el),e.pagination.setElement(e.pagination.$el)),e.search.render(),t.$popup.bottom.append(e.search.$el),e.search.setElement(e.search.$el)}})})}(jQuery);