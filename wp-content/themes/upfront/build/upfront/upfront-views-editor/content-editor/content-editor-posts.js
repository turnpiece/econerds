!function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define(["text!upfront/templates/popup.html","scripts/perfect-scrollbar/perfect-scrollbar"],function(o,i){return Backbone.View.extend({className:"upfront-entity_list-posts bordered-bottom",postListTpl:_.template(t(o).find("#upfront-post-list-tpl").html()),postSingleTpl:_.template(t(o).find("#upfront-post-single-tpl").html()),paginationTpl:_.template(t(o).find("#upfront-pagination-tpl").html()),events:{"click #upfront-list-meta .upfront-list_item-component":"handle_sort_request","click .editaction.edit":"handle_post_edit","click .editaction.view":"handle_post_view","click #upfront-list-page-path a.upfront-path-back":"handle_return_to_posts","click .editaction.trash":"trash_post"},initialize:function(t){this.collection.on("change reset",this.render,this),this.listenTo(Upfront.Events,"post:saved",this.post_saved)},render:function(){this.$el.empty().append(this.postListTpl({posts:this.collection.getPage(this.collection.pagination.currentPage),orderby:this.collection.orderby,order:this.collection.order,canEdit:Upfront.Application.user_can("EDIT"),canEditOwn:Upfront.Application.user_can("EDIT_OWN")})),i.withDebounceUpdate(this.$el.find(".upfront-scroll-panel")[0],!0,!1,!0)},handle_sort_request:function(e){var o=t(e.target).closest(".upfront-list_item-component"),i=o.attr("data-sortby"),n=this.collection.order;i&&(i==this.collection.orderby&&(n="desc"==n?"asc":"desc"),this.collection.reSort(i,n))},handle_post_edit:function(e){e.preventDefault();var o=t(e.currentTarget).closest(".upfront-list_item-post").attr("data-post_id");_upfront_post_data&&(_upfront_post_data.post_id=o),Upfront.Application.navigate("/edit/post/"+o,{trigger:!0}),Upfront.Events.trigger("click:edit:navigate",o)},handle_post_view:function(e){e.preventDefault();var o=t(e.currentTarget).closest(".upfront-list_item-post").attr("data-post_id");window.location.href=this.collection.get(o).get("permalink")},trash_post:function(e){var o=this,i=t(e.currentTarget).closest(".upfront-list_item-post.upfront-list_item"),n=i.attr("data-post_id");confirm(Upfront.Settings.l10n.global.content.delete_confirm.replace(/%s/,this.collection.get(n).get("post_type")))&&this.collection.get(n).set("post_status","trash").save().done(function(){o.collection.remove(o.collection.get(n))})},expand_post:function(o){var i=this;o.featuredImage||this.collection.post({action:"get_post_extra",postId:o.id,thumbnail:!0,thumbnailSize:"medium"}).done(function(t){t.data.thumbnail&&t.data.postId==o.id?(i.$("#upfront-page_preview-featured_image img").attr("src",t.data.thumbnail[0]).show(),i.$(".upfront-thumbnailinfo").hide(),o.featuredImage=t.data.thumbnail[0]):(i.$(".upfront-thumbnailinfo").text(e.no_image),i.$(".upfront-page_preview-edit_feature a").html('<i class="icon-plus"></i> '+e.add))}),t("#upfront-list-page").show("slide",{direction:"right"},"fast"),this.$el.find("#upfront-list").hide(),t("#upfront-page_preview-edit button").one("click",function(){var t="/edit/post/"+o.id;window.location.search.indexOf("dev=true")>-1&&(t+="?dev=true"),Upfront.Popup.close(),_upfront_post_data&&(_upfront_post_data.post_id=o.id),Upfront.Application.navigate(t,{trigger:!0})}),this.bottomContent=t("#upfront-popup-bottom").html(),t("#upfront-popup-bottom").html(t('<a href="#" id="upfront-back_to_posts">'+e.back_to_posts+"</a>").on("click",function(t){i.handle_return_to_posts()}))},post_saved:function(){this.collection.fetch()},handle_return_to_posts:function(){var e=this;this.$el.find("#upfront-list").show("slide",{direction:"left"},function(){e.collection.trigger("reset")}),t("#upfront-list-page").hide()}})})}(jQuery);