!function(e){define(["scripts/upfront/preset-settings/preset-manager","scripts/upfront/element-settings/advanced-settings","scripts/perfect-scrollbar/perfect-scrollbar"],function(e,t,i){var n=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views,s=Backbone.View.extend({id:"settings",events:{"click .upfront-save_settings":"saveSettings","click .upfront-cancel_settings":"cancelSettings"},initialize:function(i){this.options=i;var n,s,r,a=this,o={},p=!Upfront.Application.user_can("SWITCH_PRESET")&&!Upfront.Application.user_can("MODIFY_PRESET")&&!Upfront.Application.user_can("DELETE_PRESET");this.hasBreakpointSettings===!0&&(n=Upfront.Views.breakpoints_storage.get_breakpoints().get_active(),s=this.model.get_property_value_by_name("breakpoint")||{},r=s[n.id]||{},_.each(this.breakpointSpecificSettings,function(e){_.isUndefined(r[e.name])||this.model.set_property(e.name,r[e.name],!0)},this)),_.each(this.panels,function(t,i){return"Appearance"!==i||p?void(_.isFunction(t)&&(o[i]=new t({model:this.model}))):(this.appearancePanel=new e(_.extend({hasBreakpointSettings:this.hasBreakpointSettings,breakpointSpecificPresetSettings:this.breakpointSpecificPresetSettings,model:this.model},t)),this.listenTo(this.appearancePanel,"upfront:presets:state_show",this.stateShow),void(o.Appearance=this.appearancePanel))},this),Upfront.Application.user_can("MODIFY_PRESET")&&(o.Advanced=new t({model:this.model})),this.panels=o,this.on("open",function(){a.model.trigger("settings:open",a)}),this.listenTo(Upfront.Events,"element:settings:render",this.setScrollMaxHeight)},saveSettings:function(){var e,t;this.hasBreakpointSettings===!0&&this.breakpointSpecificSettings&&(e=Upfront.Views.breakpoints_storage.get_breakpoints().get_active(),t=this.model.get_property_value_by_name("breakpoint")||{},t[e.id]=t[e.id]||{},_.each(this.breakpointSpecificSettings,function(i){t[e.id][i.name]=this.model.get_property_value_by_name(i.name),t[e.id].width=e.get("width")},this),this.model.set_property("breakpoint",t,!0)),_.each(this.panels,function(e){e.save_settings()}),this.model.get("properties").trigger("change"),Upfront.Events.trigger("element:settings:saved"),Upfront.Events.trigger("element:settings:deactivate"),this.onSaveSettings&&this.onSaveSettings(),this.removePreviewClasses()},cancelSettings:function(){this.removePreviewClasses(),Upfront.Events.trigger("element:settings:canceled")},stateShow:function(e){var t=this.for_view.$el.find(".upfront-object");"static"!==e?(this.removePreviewClasses(),t.addClass("live-preview-"+e)):this.removePreviewClasses()},removePreviewClasses:function(){var e=this.for_view.$el.find(".upfront-object");e.removeClass("live-preview-hover live-preview-focus live-preview-active")},render:function(){var e=this;this.$el.html('<div class="upfront-settings-title">'+this.title+'</div><div id="sidebar-scroll-wrapper" />'),Upfront.Events.trigger("settings:prepare"),_.each(this.panels,function(t){t.render(),t.parent_view=e,e.$el.find("#sidebar-scroll-wrapper").append(t.el),i.withDebounceUpdate(e.$el.find("#sidebar-scroll-wrapper")[0],!1,"menu_element:settings:rendered",!0)}),this.$el.addClass("upfront-ui"),this.$el.append("<div class='upfront-settings-button_panel'><button type='button' class='upfront-cancel_settings'>"+n.cancel+"</button><button type='button' class='upfront-save_settings'><i class='icon-ok'></i> "+n.save_element+"</button></div>")},setScrollMaxHeight:function(){var e=this.$el.height(),t=this.$el.find(">.upfront-settings-title").outerHeight(!0),i=this.$el.find(">.upfront-settings-button_panel").outerHeight(!0);this.$el.find("#sidebar-scroll-wrapper").css("max-height",e-t-i+"px")},cleanUp:function(){this.panels&&_.each(this.panels,function(e){e.cleanUp&&e.cleanUp()}),this.remove()}});return s})}(jQuery);